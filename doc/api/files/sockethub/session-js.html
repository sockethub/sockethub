<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>/home/nkj/code/sockethub/lib/sockethub/session.js</title><link rel="stylesheet" type="text/css" href="../../styles/main.css"><script language=JavaScript src="../../javascript/main.js"></script><script language=JavaScript src="../../javascript/prettify.js"></script><script language=JavaScript src="../../javascript/searchdata.js"></script></head><body class="ContentPage" onLoad="NDOnLoad();prettyPrint();"><script language=JavaScript><!--
if (browserType) {document.write("<div class=" + browserType + ">");if (browserVer) {document.write("<div class=" + browserVer + ">"); }}// --></script>

<!--  Generated by Natural Docs, version 1.52 -->
<!--  http://www.naturaldocs.org  -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->




<div id=Content><div class="CFile"><div class=CTopic id=MainTopic><h1 class=CTitle><a name="session.js"></a>session.js</h1><div class=CBody><!--START_ND_SUMMARY--><div class=Summary><div class=STitle>Summary</div><div class=SBorder><table border=0 cellspacing=0 cellpadding=0 class=STable><tr class="SMain"><td class=SEntry><a href="#session.js" >session.js</a></td><td class=SDescription></td></tr><tr class="SGroup"><td class=SEntry><a href="#Functions" >Functions</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#SessionManager" id=link1 onMouseOver="ShowTip(event, 'tt1', 'link1')" onMouseOut="HideTip('tt1')">SessionManager</a></td><td class=SDescription>Manages the issuing of new sessions instances (each websocket connection gets it&rsquo;s own instance)</td></tr><tr class="SGroup"><td class=SEntry><a href="#Variables" >Variables</a></td><td class=SDescription></td></tr><tr class="SVariable SIndent1 SMarked"><td class=SEntry><a href="#SessionManager.prototype" id=link2 onMouseOver="ShowTip(event, 'tt2', 'link2')" onMouseOut="HideTip('tt2')">SessionManager.<wbr>prototype</a></td><td class=SDescription>SessionManager functions</td></tr><tr class="SVariable SIndent1"><td class=SEntry><a href="#instances" id=link3 onMouseOver="ShowTip(event, 'tt3', 'link3')" onMouseOut="HideTip('tt3')">instances</a></td><td class=SDescription>Class variable index of all Session instances created. </td></tr><tr class="SGroup"><td class=SEntry><a href="#Functions" >Functions</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#encKeySet" id=link4 onMouseOver="ShowTip(event, 'tt4', 'link4')" onMouseOut="HideTip('tt4')">encKeySet</a></td><td class=SDescription>boolean function to check if encKey has been set</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#clearEncKey" id=link5 onMouseOver="ShowTip(event, 'tt5', 'link5')" onMouseOut="HideTip('tt5')">clearEncKey</a></td><td class=SDescription>function to delete the encryption key</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#getAllSessionIDs" id=link6 onMouseOver="ShowTip(event, 'tt6', 'link6')" onMouseOut="HideTip('tt6')">getAllSessionIDs</a></td><td class=SDescription>returns a list of all sessionIds (keys of instances class variable)</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#get" id=link7 onMouseOver="ShowTip(event, 'tt7', 'link7')" onMouseOut="HideTip('tt7')">get</a></td><td class=SDescription>create the session instance for the given session ID.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#destroy" id=link8 onMouseOver="ShowTip(event, 'tt8', 'link8')" onMouseOut="HideTip('tt8')">destroy</a></td><td class=SDescription>handles the deletion of the session data both stored in redis or cached locally.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#request" id=link9 onMouseOver="ShowTip(event, 'tt9', 'link9')" onMouseOut="HideTip('tt9')">request</a></td><td class=SDescription>request a document from remoteStorage</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#_setConfig" id=link10 onMouseOver="ShowTip(event, 'tt10', 'link10')" onMouseOut="HideTip('tt10')">_setConfig</a></td><td class=SDescription>DO NOT USE DIRECTLY</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#_getConfig" id=link11 onMouseOver="ShowTip(event, 'tt11', 'link11')" onMouseOut="HideTip('tt11')">_getConfig</a></td><td class=SDescription>DO NOT USE DIRECTLY</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#Session" id=link12 onMouseOver="ShowTip(event, 'tt12', 'link12')" onMouseOut="HideTip('tt12')">Session</a></td><td class=SDescription>Constructor for the Session object. </td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#unregister" id=link13 onMouseOver="ShowTip(event, 'tt13', 'link13')" onMouseOut="HideTip('tt13')">unregister</a></td><td class=SDescription>unregisters the session</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#isRegistered" id=link14 onMouseOver="ShowTip(event, 'tt14', 'link14')" onMouseOut="HideTip('tt14')">isRegistered</a></td><td class=SDescription>boolean function to check registered state of session</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#getSecret" id=link15 onMouseOver="ShowTip(event, 'tt15', 'link15')" onMouseOut="HideTip('tt15')">getSecret</a></td><td class=SDescription>returns secret that this session was registered with</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#getSessionID" id=link16 onMouseOver="ShowTip(event, 'tt16', 'link16')" onMouseOut="HideTip('tt16')">getSessionID</a></td><td class=SDescription>returns sessionId of session</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#isRedisKeySet" id=link17 onMouseOver="ShowTip(event, 'tt17', 'link17')" onMouseOut="HideTip('tt17')">isRedisKeySet</a></td><td class=SDescription>boolean function to check if redis key is set</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#getPlatforms" id=link18 onMouseOver="ShowTip(event, 'tt18', 'link18')" onMouseOut="HideTip('tt18')">getPlatforms</a></td><td class=SDescription>Get a list of all platforms used by this session so far.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#_purgeConfig" id=link19 onMouseOver="ShowTip(event, 'tt19', 'link19')" onMouseOut="HideTip('tt19')">_purgeConfig</a></td><td class=SDescription>DO NOT CALL DIRECTLY</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#cleanup" id=link20 onMouseOver="ShowTip(event, 'tt20', 'link20')" onMouseOut="HideTip('tt20')">cleanup</a></td><td class=SDescription>When the session object is being destroyed, we want to cleanup any interal vars first.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#getResponseHandler" id=link21 onMouseOver="ShowTip(event, 'tt21', 'link21')" onMouseOut="HideTip('tt21')">getResponseHandler</a></td><td class=SDescription>when the listener receives a job to send to the platform module, it needs to have an simplified way to report the status of the job. </td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#getPlatformSession" id=link22 onMouseOver="ShowTip(event, 'tt22', 'link22')" onMouseOut="HideTip('tt22')">getPlatformSession</a></td><td class=SDescription>when a listener initializes a platform, it must send it a &lsquo;session&rsquo; object. </td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#getFile" id=link23 onMouseOver="ShowTip(event, 'tt23', 'link23')" onMouseOut="HideTip('tt23')">getFile</a></td><td class=SDescription>Get a file, if possible from remote storage, otherwise try from the filesystem.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#getRS" id=link24 onMouseOver="ShowTip(event, 'tt24', 'link24')" onMouseOut="HideTip('tt24')">getRS</a></td><td class=SDescription>Get a file from remoteStorage.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#PlatformSession" id=link25 onMouseOver="ShowTip(event, 'tt25', 'link25')" onMouseOut="HideTip('tt25')">PlatformSession</a></td><td class=SDescription>the PlatformSession objects (or psession) are small subsets of the Session objects and are passed to platforms during platform.init().</td></tr></table></div></div><!--END_ND_SUMMARY--></div></div></div>

<div class="CGroup"><div class=CTopic><h3 class=CTitle><a name="Functions"></a>Functions</h3></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="SessionManager"></a>SessionManager</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>var SessionManager = function (</td><td class="PParameter  prettyprint " nowrap>p</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote><p>Manages the issuing of new sessions instances (each websocket connection gets it&rsquo;s own instance)</p><h4 class=CHeading>Parameters</h4><h4 class=CHeading>an object containing the following properties</h4><p>{ platform - name of platform (text string)</p><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>sockethubId</td><td class=CDLDescription>ID created by sockethub at startup</td></tr><tr><td class=CDLEntry>encKey (optional)</td><td class=CDLDescription>this is generally set via a redis handshake, however for testing purposes (and in the case of the dispatcher, who creates the encKey before initializing the Session Manager) it&rsquo;s also allowed to set this on object instantiation.&nbsp; }</td></tr></table></div></div></div>

<div class="CGroup"><div class=CTopic><h3 class=CTitle><a name="Variables"></a>Variables</h3></div></div>

<div class="CVariable"><div class=CTopic><h3 class=CTitle><a name="SessionManager.prototype"></a>SessionManager.<wbr>prototype</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">SessionManager.prototype</td></tr></table></blockquote><p>SessionManager functions</p></div></div></div>

<div class="CVariable"><div class=CTopic><h3 class=CTitle><a name="instances"></a>instances</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">SessionManager.prototype.instances</td></tr></table></blockquote><p>Class variable index of all Session instances created. sessionId is the key, value is the session object.</p></div></div></div>

<div class="CGroup"><div class=CTopic><h3 class=CTitle><a name="Functions"></a>Functions</h3></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="encKeySet"></a>encKeySet</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">SessionManager.prototype.encKeySet = function ()</td></tr></table></blockquote><p>boolean function to check if encKey has been set</p><h4 class=CHeading>Returns</h4><p>boolean</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="clearEncKey"></a>clearEncKey</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">SessionManager.prototype.clearEncKey = function ()</td></tr></table></blockquote><p>function to delete the encryption key</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="getAllSessionIDs"></a>getAllSessionIDs</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">SessionManager.prototype.getAllSessionIDs = function ()</td></tr></table></blockquote><p>returns a list of all sessionIds (keys of instances class variable)</p><h4 class=CHeading>Returns</h4><p>array of sessionIds</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="get"></a>get</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>SessionManager.prototype.get = function (</td><td class="PParameter  prettyprint " nowrap>sid,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>create</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote><p>create the session instance for the given session ID.</p><ul><li>If it exists in memory, it&rsquo;s returned.</li><li>If it exists in the redis store, it&rsquo;s retreived and built for a local instance.</li><li>If the session doesn&rsquo;t exist yet, a new one will be created.</li></ul><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>sid</td><td class=CDLDescription>the session ID to lookup/create</td></tr><tr><td class=CDLEntry>create</td><td class=CDLDescription>if this flag is set to false, the session will not be created if it does not already exist (defaults to true)</td></tr></table><h4 class=CHeading>Returns</h4><p>promise with session object</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="destroy"></a>destroy</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>SessionManager.prototype.destroy = function (</td><td class="PParameter  prettyprint " nowrap>sid</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote><p>handles the deletion of the session data both stored in redis or cached locally.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>sid</td><td class=CDLDescription>the session ID to destroy</td></tr></table><h4 class=CHeading>Returns</h4><p>promise</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="request"></a>request</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>SessionManager.prototype.request = function (</td><td class="PParameter  prettyprint " nowrap>p</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote><p>request a document from remoteStorage</p><h4 class=CHeading>Parameters</h4><h4 class=CHeading>an object with the following properties</h4><p>{ rsConfig - object containing rs config method   - GET POST, etc. path     - full path of request mimeType - for writes (POST), this specifies the mimetype body     - for writes (POST), this specifies the content body }</p><h4 class=CHeading>Returns</h4><p>a promise which is fulfilled when the document retreival is completed</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="_setConfig"></a>_setConfig</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>SessionManager.prototype._setConfig = function (</td><td class="PParameter  prettyprint " nowrap>platform,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>type,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>key,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>data</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote><p>DO NOT USE DIRECTLY</p><p>stores data to the redis db.</p><p>first checks to see if the key (name) is already there for this platforms channel. if it is, it grabs the data, decrypts it, adds the new data, then encrypts and stores it back in the redis db.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>platform</td><td class=CDLDescription>platform name (will be curry&rsquo;d in the session object)</td></tr><tr><td class=CDLEntry>type</td><td class=CDLDescription>type of data being stored, ie.&nbsp; &lsquo;credentials&rsquo;</td></tr><tr><td class=CDLEntry>key</td><td class=CDLDescription>unique string to stored the data under</td></tr><tr><td class=CDLEntry>data</td><td class=CDLDescription>data to store</td></tr></table><h4 class=CHeading>Returns</h4><p>promise</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="_getConfig"></a>_getConfig</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>SessionManager.prototype._getConfig = function (</td><td class="PParameter  prettyprint " nowrap>platform,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>type,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>key,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>refresh</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote><p>DO NOT USE DIRECTLY</p><p>fetches redis data based on platform and key name. decrypts and sends the desired data in a promise.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>platform</td><td class=CDLDescription>platform name (will be curry&rsquo;d in the session object)</td></tr><tr><td class=CDLEntry>type</td><td class=CDLDescription>type to fetch, ie.&nbsp; &lsquo;credentials&rsquo;, &lsquo;remoteStorage&rsquo;</td></tr><tr><td class=CDLEntry>key</td><td class=CDLDescription>unique string that the data is stored under</td></tr><tr><td class=CDLEntry>refresh</td><td class=CDLDescription>CURRENTLY NOT IMPLEMENTED</td></tr></table><h4 class=CHeading>Example</h4><blockquote><pre class="prettyprint">   session.getConfig('credentials', 'silverbucket').
     then(function (credentials) {
       // got credential object for 'silverbucket', or null
     });
   (end code):

Returns:

  promise with data as first param</pre></blockquote></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="Session"></a>Session</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>var Session = function (</td><td class="PParameter  prettyprint " nowrap>parent,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>sid</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote><p>Constructor for the Session object.&nbsp; Each session object is issued via the SessionManager&rsquo;s get function.&nbsp; So an external user of the session module will not use this constructor directly.</p><p>Session objects are used by listeners and dispatchers.&nbsp; Not by the platforms themselves (those are PlatformSession objects, defined further down this file).</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>sid</td><td class=CDLDescription>sessionId (a sessionId is issued for each websocket connection)</td></tr></table></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="unregister"></a>unregister</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">Session.prototype.unregister = function ()</td></tr></table></blockquote><p>unregisters the session</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="isRegistered"></a>isRegistered</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">Session.prototype.isRegistered = function ()</td></tr></table></blockquote><p>boolean function to check registered state of session</p><h4 class=CHeading>Returns</h4><p>boolean</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="getSecret"></a>getSecret</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">Session.prototype.getSecret = function()</td></tr></table></blockquote><p>returns secret that this session was registered with</p><h4 class=CHeading>Returns</h4><p>secret (string)</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="getSessionID"></a>getSessionID</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">Session.prototype.getSessionID = function()</td></tr></table></blockquote><p>returns sessionId of session</p><h4 class=CHeading>Returns</h4><p>sessionId (string)</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="isRedisKeySet"></a>isRedisKeySet</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">Session.prototype.isRedisKeySet = function ()</td></tr></table></blockquote><p>boolean function to check if redis key is set</p><h4 class=CHeading>Returns</h4><p>boolean</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="getPlatforms"></a>getPlatforms</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">Session.prototype.getPlatforms = function()</td></tr></table></blockquote><p>Get a list of all platforms used by this session so far.</p><h4 class=CHeading>Returns</h4><p>array of platform names (array of strings)</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="_purgeConfig"></a>_purgeConfig</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>Session.prototype._purgeConfig = function (</td><td class="PParameter  prettyprint " nowrap>platform</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote><p>DO NOT CALL DIRECTLY</p><p>internal function to purge existing data from redis (matching this specific index string). done during register and also during cleanup.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>platform</td><td class=CDLDescription>platform name (string)</td></tr></table></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="cleanup"></a>cleanup</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">Session.prototype.cleanup = function()</td></tr></table></blockquote><p>When the session object is being destroyed, we want to cleanup any interal vars first.</p><h4 class=CHeading>Parameters</h4><p>none</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="getResponseHandler"></a>getResponseHandler</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>Session.prototype.getResponseHandler = function (</td><td class="PParameter  prettyprint " nowrap>job</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote><p>when the listener receives a job to send to the platform module, it needs to have an simplified way to report the status of the job.&nbsp; This function is called by the listener, and returns a function which handles all the details of sending a response back to the client.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>job</td><td class=CDLDescription>the job object received by the listener from the redis queue</td></tr></table><h4 class=CHeading>Returns</h4><p>a function which handles sending the response back to the client. it takes 3 parameters: errMsg - text string of any error, null if none status - boolean true or false object - anything to be placed in the responses &lsquo;object&rsquo; property</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="getPlatformSession"></a>getPlatformSession</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>Session.prototype.getPlatformSession = function (</td><td class="PParameter  prettyprint " nowrap>platform</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote><p>when a listener initializes a platform, it must send it a &lsquo;session&rsquo; object. this object is <b>actually</b> a &lsquo;platform session&rsquo; object, and not the session object that the listener, itself uses (where this function lives).</p><p>so the listener, using it&rsquo;s session object, calls session.getPlatformSession and receives a platform session (or psession) which it then sends to the platform during the init() call.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>platform</td><td class=CDLDescription>platform name (string)</td></tr></table><h4 class=CHeading>Returns</h4><p>promise where, upon succes, calls back with a psession object as the first param.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="getFile"></a>getFile</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>Session.prototype.getFile = function (</td><td class="PParameter  prettyprint " nowrap>module,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>path</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote><p>Get a file, if possible from remote storage, otherwise try from the filesystem.</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>module</td><td class=CDLDescription>base directory/module</td></tr><tr><td class=CDLEntry>path</td><td class=CDLDescription>path (append to module) including filename</td></tr></table><h4 class=CHeading>Returns</h4><p>returns a promise, which can fulfill an array with two elements: [source, resource] source - the place the resource was retreived from, &lsquo;remotestorage&rsquo; &lsquo;filesystem&rsquo; resource - the JSON object (in some cases could be a directory listing)</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="getRS"></a>getRS</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>Session.prototype.getRS = function (</td><td class="PParameter  prettyprint " nowrap>module,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>path</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote><p>Get a file from remoteStorage.</p><h4 class=CHeading>Example</h4><p>// will GET {storageRoot}/messages/.xmpp and (if applicable) // parse it&rsquo;s content as JSON. rgetRS(&lsquo;sockethub&rsquo;, &lsquo;credentials/email&rsquo;)</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>module</td><td class=CDLDescription>name of remoteStorage module (string)</td></tr><tr><td class=CDLEntry>path</td><td class=CDLDescription>path relative to module (string)</td></tr></table><h4 class=CHeading>Returns</h4><p>return promise containing data (if successful)</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="PlatformSession"></a>PlatformSession</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>function PlatformSession(</td><td class="PParameter  prettyprint " nowrap>p</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote><p>the PlatformSession objects (or psession) are small subsets of the Session objects and are passed to platforms during platform.init().</p><p>the contain a number of methods that make communicating with the client easy, and abstract away as much sockethub internals as possible.</p><h4 class=CHeading>Parameters</h4><h4 class=CHeading>an object containing the following properties</h4><p>{ platform - name of platform (text string)</p><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>sockethubId</td><td class=CDLDescription>ID created by sockethub at startup</td></tr><tr><td class=CDLEntry>sid</td><td class=CDLDescription>session ID issued during websocket connect</td></tr><tr><td class=CDLEntry>redis_key</td><td class=CDLDescription>the redis key string for this platform</td></tr><tr><td class=CDLEntry>enc_key</td><td class=CDLDescription>used for redis data storing, kept in a closure and not exposed to platform }</td></tr></table></div></div></div>

</div><!--Content-->


<div id=Footer><a href="http://www.naturaldocs.org">Generated by Natural Docs</a></div><!--Footer-->


<div id=Menu><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent1')">Platforms</a><div class=MGroupContent id=MGroupContent1><div class=MEntry><div class=MFile><a href="../platforms/feeds-js.html">fetch</a></div></div><div class=MEntry><div class=MFile><a href="../platforms/email-js.html">fetch</a></div></div><div class=MEntry><div class=MFile><a href="../platforms/xmpp-old-js.html">init</a></div></div><div class=MEntry><div class=MFile><a href="../platforms/irc-js.html">irc.js</a></div></div><div class=MEntry><div class=MFile><a href="../platforms/xmpp-js.html">xmpp.js</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent2')">Schemas</a><div class=MGroupContent id=MGroupContent2><div class=MEntry><div class=MFile><a href="../schemas/aliases-js.html">aliases</a></div></div><div class=MEntry><div class=MFile><a href="../schemas/platforms-js.html">platforms</a></div></div><div class=MEntry><div class=MFile><a href="../schemas/verbs-js.html">verbs</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent3')">Sockethub</a><div class=MGroupContent id=MGroupContent3><div class=MEntry><div class=MFile><a href="listener-js.html">cleanupPlatform</a></div></div><div class=MEntry><div class=MFile><a href="client-manager-js.html">client-manager.js</a></div></div><div class=MEntry><div class=MFile><a href="config-loader-js.html">ConfigLoader</a></div></div><div class=MEntry><div class=MFile><a href="dispatcher-js.html">dispatcher.js</a></div></div><div class=MEntry><div class=MFile id=MSelected>session.js</div></div><div class=MEntry><div class=MFile><a href="sockethub-js.html">Sockethub</a></div></div><div class=MEntry><div class=MFile><a href="subsystem-js.html">subsystem.js</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent4')">Index</a><div class=MGroupContent id=MGroupContent4><div class=MEntry><div class=MIndex><a href="../../index/General.html">Everything</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Files.html">Files</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Functions.html">Functions</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Variables.html">Variables</a></div></div></div></div></div><script type="text/javascript"><!--
var searchPanel = new SearchPanel("searchPanel", "HTML", "../../search");
--></script><div id=MSearchPanel class=MSearchPanelInactive><input type=text id=MSearchField value=Search onFocus="searchPanel.OnSearchFieldFocus(true)" onBlur="searchPanel.OnSearchFieldFocus(false)" onKeyUp="searchPanel.OnSearchFieldChange()"><select id=MSearchType onFocus="searchPanel.OnSearchTypeFocus(true)" onBlur="searchPanel.OnSearchTypeFocus(false)" onChange="searchPanel.OnSearchTypeChange()"><option  id=MSearchEverything selected value="General">Everything</option><option value="Files">Files</option><option value="Functions">Functions</option><option value="Variables">Variables</option></select></div></div><!--Menu-->



<!--START_ND_TOOLTIPS-->
<div class=CToolTip id="tt1"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>var SessionManager = function (</td><td class="PParameter  prettyprint " nowrap>p</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>Manages the issuing of new sessions instances (each websocket connection gets it&rsquo;s own instance)</div></div><div class=CToolTip id="tt2"><div class=CVariable><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">SessionManager.prototype</td></tr></table></blockquote>SessionManager functions</div></div><div class=CToolTip id="tt3"><div class=CVariable><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">SessionManager.prototype.instances</td></tr></table></blockquote>Class variable index of all Session instances created. </div></div><div class=CToolTip id="tt4"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">SessionManager.prototype.encKeySet = function ()</td></tr></table></blockquote>boolean function to check if encKey has been set</div></div><div class=CToolTip id="tt5"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">SessionManager.prototype.clearEncKey = function ()</td></tr></table></blockquote>function to delete the encryption key</div></div><div class=CToolTip id="tt6"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">SessionManager.prototype.getAllSessionIDs = function ()</td></tr></table></blockquote>returns a list of all sessionIds (keys of instances class variable)</div></div><div class=CToolTip id="tt7"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>SessionManager.prototype.get = function (</td><td class="PParameter  prettyprint " nowrap>sid,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>create</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>create the session instance for the given session ID.</div></div><div class=CToolTip id="tt8"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>SessionManager.prototype.destroy = function (</td><td class="PParameter  prettyprint " nowrap>sid</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>handles the deletion of the session data both stored in redis or cached locally.</div></div><div class=CToolTip id="tt9"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>SessionManager.prototype.request = function (</td><td class="PParameter  prettyprint " nowrap>p</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>request a document from remoteStorage</div></div><div class=CToolTip id="tt10"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>SessionManager.prototype._setConfig = function (</td><td class="PParameter  prettyprint " nowrap>platform,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>type,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>key,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>data</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>DO NOT USE DIRECTLY</div></div><div class=CToolTip id="tt11"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>SessionManager.prototype._getConfig = function (</td><td class="PParameter  prettyprint " nowrap>platform,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>type,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>key,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>refresh</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>DO NOT USE DIRECTLY</div></div><div class=CToolTip id="tt12"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>var Session = function (</td><td class="PParameter  prettyprint " nowrap>parent,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>sid</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>Constructor for the Session object. </div></div><div class=CToolTip id="tt13"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">Session.prototype.unregister = function ()</td></tr></table></blockquote>unregisters the session</div></div><div class=CToolTip id="tt14"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">Session.prototype.isRegistered = function ()</td></tr></table></blockquote>boolean function to check registered state of session</div></div><div class=CToolTip id="tt15"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">Session.prototype.getSecret = function()</td></tr></table></blockquote>returns secret that this session was registered with</div></div><div class=CToolTip id="tt16"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">Session.prototype.getSessionID = function()</td></tr></table></blockquote>returns sessionId of session</div></div><div class=CToolTip id="tt17"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">Session.prototype.isRedisKeySet = function ()</td></tr></table></blockquote>boolean function to check if redis key is set</div></div><div class=CToolTip id="tt18"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">Session.prototype.getPlatforms = function()</td></tr></table></blockquote>Get a list of all platforms used by this session so far.</div></div><div class=CToolTip id="tt19"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>Session.prototype._purgeConfig = function (</td><td class="PParameter  prettyprint " nowrap>platform</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>DO NOT CALL DIRECTLY</div></div><div class=CToolTip id="tt20"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td class="prettyprint">Session.prototype.cleanup = function()</td></tr></table></blockquote>When the session object is being destroyed, we want to cleanup any interal vars first.</div></div><div class=CToolTip id="tt21"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>Session.prototype.getResponseHandler = function (</td><td class="PParameter  prettyprint " nowrap>job</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>when the listener receives a job to send to the platform module, it needs to have an simplified way to report the status of the job. </div></div><div class=CToolTip id="tt22"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>Session.prototype.getPlatformSession = function (</td><td class="PParameter  prettyprint " nowrap>platform</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>when a listener initializes a platform, it must send it a &lsquo;session&rsquo; object. </div></div><div class=CToolTip id="tt23"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>Session.prototype.getFile = function (</td><td class="PParameter  prettyprint " nowrap>module,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>path</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>Get a file, if possible from remote storage, otherwise try from the filesystem.</div></div><div class=CToolTip id="tt24"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>Session.prototype.getRS = function (</td><td class="PParameter  prettyprint " nowrap>module,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>path</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>Get a file from remoteStorage.</div></div><div class=CToolTip id="tt25"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>function PlatformSession(</td><td class="PParameter  prettyprint " nowrap>p</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>the PlatformSession objects (or psession) are small subsets of the Session objects and are passed to platforms during platform.init().</div></div><!--END_ND_TOOLTIPS-->




<div id=MSearchResultsWindow><iframe src="" frameborder=0 name=MSearchResults id=MSearchResults></iframe><a href="javascript:searchPanel.CloseResultsWindow()" id=MSearchResultsWindowClose>Close</a></div>


<script language=JavaScript><!--
if (browserType) {if (browserVer) {document.write("</div>"); }document.write("</div>");}// --></script></body></html>